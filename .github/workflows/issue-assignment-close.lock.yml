name: GH-AW Issue Assignment + Close
on:
  issues:
    types: [labeled]
permissions:
  contents: read
  issues: write
jobs:
  agent:
    if: github.event.action == 'labeled' && (github.event.label.name == 'opinion-copilot-strategy-posted' || github.event.label.name == 'opinion-copilot-delivery-posted')
    runs-on: ubuntu-latest
    steps:
      - name: Run GH-AW agent
        uses: github/agentic-workflows@v1
        with:
          engine: copilot
          tools: github:issues
          prompt: |
            # Close slow-track issue after two Copilot opinions

            You are the assignment agent.

            ## Instructions

            - Read issue #${{ github.event.issue.number }} and all labels.
            - Continue only when **both** labels are present:
              - `opinion-copilot-strategy-posted`
              - `opinion-copilot-delivery-posted`
            - If either label is missing, exit with no action.
            - Post an assignment summary comment that cites both opinions.
            - Add label `assigned`.
            - Close the issue.
            - If the issue should be declined instead:
              - explain why,
              - add `rejected`,
              - close the issue.
