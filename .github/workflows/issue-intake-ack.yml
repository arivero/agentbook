name: Issue Intake ACK

on:
  issues:
    types: [opened]
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'Issue number to acknowledge and route'
        required: true
        type: string

permissions:
  actions: write
  contents: read
  issues: write

jobs:
  acknowledge-and-dispatch:
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.issue.pull_request == null }}
    runs-on: ubuntu-latest
    env:
      ISSUE_NUMBER: ${{ inputs.issue_number || github.event.issue.number }}
    steps:
      - name: Acknowledge issue
        run: |
          gh issue comment "${ISSUE_NUMBER}" \
            --repo "${{ github.repository }}" \
            --body "Thanks for opening this suggestion. It has been acknowledged and is now queued for agentic routing."
        env:
          GH_TOKEN: ${{ github.token }}

      - name: Apply intake label
        run: |
          gh issue edit "${ISSUE_NUMBER}" \
            --repo "${{ github.repository }}" \
            --add-label "acknowledged"
        env:
          GH_TOKEN: ${{ github.token }}

      - name: Dispatch routing workflow
        run: |
          gh workflow run "issue-routing-decision.lock.yml" \
            --repo "${{ github.repository }}" \
            --ref "${{ github.ref_name }}" \
            -f issue_number="${ISSUE_NUMBER}"
        env:
          GH_TOKEN: ${{ github.token }}
