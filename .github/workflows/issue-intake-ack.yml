name: Issue Intake ACK

on:
  issues:
    types: [opened]

permissions:
  actions: write
  contents: read
  issues: write

jobs:
  acknowledge-and-dispatch:
    if: ${{ github.event.issue.pull_request == null }}
    runs-on: ubuntu-latest
    steps:
      - name: Acknowledge issue
        run: |
          gh issue comment "${{ github.event.issue.number }}" \
            --repo "${{ github.repository }}" \
            --body "Thanks for opening this suggestion. It has been acknowledged and is now queued for agentic routing."
        env:
          GH_TOKEN: ${{ github.token }}

      - name: Apply intake label
        run: |
          gh issue edit "${{ github.event.issue.number }}" \
            --repo "${{ github.repository }}" \
            --add-label "acknowledged"
        env:
          GH_TOKEN: ${{ github.token }}

      - name: Dispatch routing workflow
        run: |
          gh workflow run "issue-routing-decision.lock.yml" \
            --repo "${{ github.repository }}" \
            --ref "${{ github.event.repository.default_branch }}" \
            -f issue_number="${{ github.event.issue.number }}"
        env:
          GH_TOKEN: ${{ github.token }}
