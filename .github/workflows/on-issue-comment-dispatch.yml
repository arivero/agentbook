name: Issue Comment Dispatcher

on:
  issue_comment:
    types: [created]

permissions:
  actions: write
  contents: read

concurrency:
  group: issue-comment-dispatch-${{ github.event.issue.number }}
  cancel-in-progress: false

jobs:
  dispatch:
    if: ${{ github.event.issue.pull_request == null }}
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch to phase 1
        if: ${{ contains(github.event.comment.body, 'AI generated by [GH-AW Issue Research Pass]') }}
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh workflow run "issue-phase1-dispatch.yml" \
            --repo "${{ github.repository }}" \
            --ref "${{ github.event.repository.default_branch || github.ref_name }}" \
            -f issue_number="${{ github.event.issue.number }}"

      - name: Dispatch to phase 2
        if: ${{ contains(github.event.comment.body, 'AI generated by [GH-AW Issue Phase 1 (') }}
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh workflow run "issue-phase2-dispatch.yml" \
            --repo "${{ github.repository }}" \
            --ref "${{ github.event.repository.default_branch || github.ref_name }}" \
            -f issue_number="${{ github.event.issue.number }}"

      - name: Dispatch to assignment
        if: ${{ contains(github.event.comment.body, 'AI generated by [GH-AW Issue Phase 2 (') }}
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          gh workflow run "issue-assignment-dispatch.yml" \
            --repo "${{ github.repository }}" \
            --ref "${{ github.event.repository.default_branch || github.ref_name }}" \
            -f issue_number="${{ github.event.issue.number }}"
